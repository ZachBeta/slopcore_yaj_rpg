<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplayer Debug Tool</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    #container {
      position: relative;
      width: 100%;
      height: 100%;
      background-color: #222;
    }
    
    #debug-container {
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
    }
    
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 10px;
      color: white;
      z-index: 100;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    button {
      background-color: #4d7cfe;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    
    button:hover {
      background-color: #3a67da;
    }
    
    input[type="text"] {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      min-width: 300px;
    }
    
    .player-position {
      display: flex;
      gap: 5px;
      align-items: center;
    }
    
    .player-position input {
      width: 60px;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 20px 40px;
      border-radius: 10px;
      z-index: 200;
      text-align: center;
    }
    
    .loading.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="debug-container"></div>
    
    <div id="controls">
      <div>
        <label for="server-url">Server URL:</label>
        <input type="text" id="server-url" value="http://localhost:3000" />
      </div>
      
      <div class="player-position">
        <label>Position:</label>
        <input type="number" id="pos-x" value="0" step="1" />
        <input type="number" id="pos-y" value="1" step="1" />
        <input type="number" id="pos-z" value="0" step="1" />
        <button id="send-position">Send Position</button>
      </div>
      
      <button id="connect">Connect</button>
      <button id="request-debug">Request Debug State</button>
      <button id="move-random">Random Movement</button>
    </div>
    
    <div id="loading" class="loading">
      Loading resources...
    </div>
  </div>

  <!-- Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.6.1/dist/socket.io.min.js"></script>
  
  <!-- App bundle with debugger -->
  <script src="/debug/multiplayer-debug.bundle.js"></script>
  
  <script>
    // Wait for resources to load
    window.addEventListener('load', () => {
      // Hide loading message
      document.getElementById('loading').classList.add('hidden');
      
      let debuggerInstance = null;
      const connectBtn = document.getElementById('connect');
      const serverUrlInput = document.getElementById('server-url');
      const requestDebugBtn = document.getElementById('request-debug');
      const moveRandomBtn = document.getElementById('move-random');
      const sendPositionBtn = document.getElementById('send-position');
      const posXInput = document.getElementById('pos-x');
      const posYInput = document.getElementById('pos-y');
      const posZInput = document.getElementById('pos-z');
      
      // Connect to server and initialize debugger
      connectBtn.addEventListener('click', () => {
        const serverUrl = serverUrlInput.value.trim();
        if (!serverUrl) {
          alert('Please enter a valid server URL');
          return;
        }
        
        // Cleanup previous debugger if exists
        if (debuggerInstance) {
          debuggerInstance.dispose();
        }
        
        try {
          // Initialize new debugger
          debuggerInstance = window.createMultiplayerDebugger(serverUrl, 'debug-container');
          connectBtn.textContent = 'Reconnect';
        } catch (error) {
          console.error('Failed to initialize debugger:', error);
          alert(`Failed to initialize debugger: ${error.message}`);
        }
      });
      
      // Request debug state
      requestDebugBtn.addEventListener('click', () => {
        if (!debuggerInstance) {
          alert('Please connect to a server first');
          return;
        }
        
        debuggerInstance.requestDebugState();
      });
      
      // Send a random position update
      moveRandomBtn.addEventListener('click', () => {
        if (!debuggerInstance) {
          alert('Please connect to a server first');
          return;
        }
        
        const position = {
          x: Math.floor(Math.random() * 20 - 10),
          y: Math.floor(Math.random() * 5 + 1),
          z: Math.floor(Math.random() * 20 - 10)
        };
        
        const rotation = {
          x: 0,
          y: Math.random() * Math.PI * 2,
          z: 0
        };
        
        // Update inputs
        posXInput.value = position.x;
        posYInput.value = position.y;
        posZInput.value = position.z;
        
        // Send update
        debuggerInstance.sendPositionUpdate(position, rotation);
      });
      
      // Send position from input fields
      sendPositionBtn.addEventListener('click', () => {
        if (!debuggerInstance) {
          alert('Please connect to a server first');
          return;
        }
        
        const position = {
          x: parseFloat(posXInput.value) || 0,
          y: parseFloat(posYInput.value) || 1,
          z: parseFloat(posZInput.value) || 0
        };
        
        const rotation = {
          x: 0,
          y: 0,
          z: 0
        };
        
        debuggerInstance.sendPositionUpdate(position, rotation);
      });
    });
  </script>
</body>
</html> 